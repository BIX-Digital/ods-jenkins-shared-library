// Document generated by render-adoc.go from odsComponentStageScanWithAqua.adoc.tmpl; DO NOT EDIT.

The "Aqua Security Scan" stage scans an image that was previously build in that same pipeline run.

As a result, a BitBucket Code Insight entry is added to the git commit (in BitBucket) that basically
contains a link to the scan result on the Aqua platform. The BitBucket Code Insight entry can be seen in a Pull Request.
A Pull Request in BitBucket shows the Code Insight of the latest commit of the PR.

To get started, make sure you have a `ConfigMap` in your project-cd namespace in OpenShift that has these fields:
----
...
metadata:
  name: aqua
...
data:
  registry: <registry-name-in-aqua-platform>
  secretName: <secret-name-of-aqua-user-credentials>
  url: <aqua-platform-url>
----

. `registry`: Refers to a name for the image registry given in the aqua platform by an aqua platform admin.
. `secretName`: Name of the `Secret` that contains the credentials of the aqua platform user that is used for executing the scan command. That user needs to have scanner rights.
. `url`: Base URL of the aqua platform.

Now, to use the stage, add it in your `Jenkinsfile`, e.g. like this:
----
) { context ->
    ...
    odsComponentStageScanWithAqua(context)
    ...
}
----

== Options

[cols="1,2"]
|===
| Option | Description


| *branch* +
_String_
|Branch to run stage for.
 Example: `'master'`.
 Next to exact matches, it also supports prefixes (e.g. `feature/`) and all branches (`*`).


| *branches* +
_List<String>_
|Branches to run stage for.
 Example: `['master', 'develop']`.
 Next to exact matches, it also supports prefixes (e.g. `feature/`) and all branches (`*`).


| *resourceName* +
_String_
|Name of `BuildConfig`/`ImageStream` of the image that we want to scan (defaults to `context.componentId`).
 BuildOpenShiftImageStage puts the imageRef into a map with the `resourceName` as key.
 In order to be able to receive the imageRef for scanning, the `resourceName` needs
 to be the same as in BuildOpenShiftImageStage.

|===
